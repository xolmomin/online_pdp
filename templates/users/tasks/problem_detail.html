{% extends 'users/base.html' %}
{% load custom_filters %}
{% load static %}

{% block title %}{{ problem.name }} | EduHub{% endblock %}

{% block custom_css %}
    <link rel="stylesheet" href="{% static 'tasks/css/base.css' %}">
    <link rel="stylesheet" href="{% static 'tasks/css/editor.css' %}">
    <link rel="stylesheet" href="{% static 'tasks/css/results.css' %}">
    <link rel="stylesheet" href="{% static 'tasks/css/problem.css' %}">
    <link rel="stylesheet" href="{% static 'tasks/css/layout.css' %}">
    <link rel="stylesheet" href="{% static 'tasks/css/output.css' %}">
{% endblock %}

{% block content %}
    <div class="main-container">
        <!-- LEFT SIDE: Problem Section -->
        <div class="resizable-section" id="problem-section" style="width: 50%;">
            <div class="problem-section">
                <!-- Blue Navigation Bar -->
                <div class="bg-blue-600 text-white flex gap-6 px-6 py-3 font-medium text-sm rounded-t-xl">
                    <button class="hover:text-blue-200">Description</button>
                    <button class="hover:text-blue-200">Editorial</button>
                    <button class="hover:text-blue-200">Solutions</button>
                    <button class="hover:text-blue-200">Submissions</button>
                </div>

                <!-- Problem Content -->
                <div class="problem-content">
                    <div class="flex justify-between items-center mb-4">
                        <h1 class="text-3xl font-bold text-gray-900">{{ problem.name }}</h1>
                        <span class="text-green-600 font-semibold text-sm">Solved ‚úÖ</span>
                    </div>

                    <div class="flex items-center gap-3 mb-6 text-sm">
                        <span class="text-gray-400">#{{ problem.pk }}</span>

                        <span class="px-3 py-1 rounded-full font-medium
                      {% if problem.difficulty == 'Easy' %}bg-green-100 text-green-700
                      {% elif problem.difficulty == 'Medium' %}bg-yellow-100 text-yellow-700
                      {% else %}bg-red-100 text-red-700{% endif %}">
                      {{ problem.difficulty }}
                    </span>
                        <span class="px-2 py-1 bg-blue-50 text-blue-700 rounded-md border border-blue-200">üß† Topics</span>
                    </div>

                    <article class="leading-relaxed mb-8 text-gray-700">
                        {{ problem.description|safe }}
                    </article>

                    <div class="mb-8">
                        {% for example in problem.examples.all %}
                            <h2 class="text-lg font-semibold mb-2 text-gray-900">Example {{ forloop.counter }}:</h2>
                            <div class="bg-gray-50 border border-gray-200 rounded-lg p-4 mb-4">
                                <p><span class="font-semibold text-blue-600">Input:</span>
                                    <code class="bg-gray-100 px-1 rounded">{{ example.input }}</code>
                                </p>
                                <p><span class="font-semibold text-blue-600">Output:</span>
                                    <code class="bg-gray-100 px-1 rounded">{{ example.output }}</code>
                                </p>
                                {% if example.explanation %}
                                    <p class="mt-1 text-gray-600">
                                        <span class="font-semibold text-blue-600">Explanation:</span> {{ example.explanation }}
                                    </p>
                                {% endif %}
                            </div>
                        {% endfor %}
                    </div>

                    {% if problem.constraints %}
                        <div class="mb-8">
                            <h2 class="text-lg font-semibold mb-2 text-gray-900">Constraints:</h2>
                            <ul class="list-disc list-inside space-y-1 text-gray-700">
                                {{ problem.constraints|linebreaksbr }}
                            </ul>
                        </div>
                    {% endif %}

                    <div class="text-gray-600 text-sm border-t border-gray-200 pt-4">
                        <span class="font-semibold text-gray-800">Follow-up:</span>
                        Can you come up with an algorithm that is less than
                        <code class="bg-gray-100 px-1 rounded">O(n¬≤)</code> time complexity?
                    </div>
                </div>
            </div>
        </div>

        <!-- Horizontal Resizer for Left/Right Panels -->
        <div class="horizontal-resizer" id="horizontal-resizer"></div>

        <!-- RIGHT PANEL: Editor + Output + Results -->
        <div class="right-panel">
            <div class="editor-output-container">
                <!-- Code Editor -->
                <div class="editor-container-right resizable-section" id="editor-section" style="height: 50%;">
                    <div class="editor-header-right">
                        <span class="font-semibold">Python 3</span>
                        <div class="flex gap-2">
                            <button class="run-button bg-green-500 hover:bg-green-600 px-3 py-1 rounded text-sm font-medium">
                                Run
                            </button>
                            <button class="submit-button bg-blue-500 hover:bg-blue-700 px-3 py-1 rounded text-sm font-medium">
                                Submit
                            </button>
                        </div>
                    </div>

                    <div class="monaco-editor-container">
                        <div id="python-editor" style="width: 100%; height: 100%;"></div>
                    </div>
                </div>

                <!-- Vertical Resizer for Editor/Output -->
                <div class="vertical-resizer" id="vertical-resizer"></div>

                <!-- Output and Results Container -->
                <div class="resizable-section" id="output-results-section" style="height: 50%;">
                    <div class="results-container-right" style="height: 100%;">
                        <div class="tabs">
                            <div class="tab active" data-tab="output">Output</div>
                            <div class="tab" data-tab="results">Test Results</div>
                        </div>

                        <!-- Output Tab -->
                        <div class="tab-content active" id="output-tab">
                            <div id="output-box"
                                 class="bg-gray-50 text-sm font-mono text-gray-800 p-4 overflow-y-auto flex-1">
                                Run your code to see output here...
                            </div>
                        </div>

                        <!-- Test Results Tab -->
                        <div class="tab-content" id="results-tab">
                            <div class="results-content" id="test-results">
                                <div class="text-gray-500 text-sm p-4 text-center">
                                    Run your code to see test results...
                                </div>
                            </div>
                            <div class="results-summary" id="results-summary" style="display: none;">
                                <div class="summary-stats">
                                    <div class="stat stat-passed">
                                        <span>‚úÖ</span>
                                        <span id="passed-count">0</span> passed
                                    </div>
                                    <div class="stat stat-failed">
                                        <span>‚ùå</span>
                                        <span id="failed-count">0</span> failed
                                    </div>
                                    <div class="stat stat-total">
                                        <span>üìä</span>
                                        <span id="total-count">0</span> total
                                    </div>
                                </div>
                                <div class="summary-message" id="summary-message"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block custom_js %}
    <script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.49.0/min/vs/loader.min.js"></script>
    <script>
        window.urls = {
            runCode: "{% url 'run_code' %}",
            submitCode: "{% url 'submit_code' %}"
        };
        window.problemID = {{ problem.pk }};
    </script>
    <script src="{% static 'tasks/js/editor.js' %}"></script>
    <script src="{% static 'tasks/js/resize_handlers.js' %}"></script>
    <script src="{% static 'tasks/js/tab_controls.js' %}"></script>
    <script src="{% static 'tasks/js/code_runner.js' %}"></script>
{% endblock %}