{% extends 'users/base.html' %}
{% load static %}

{% block title %}
    Blog Detail - EduHub Learning Platform
{% endblock %}

{% block custom_css %}
    <style>
        .author-avatar {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 12px;
        }

        .step-count-badge {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }

        .reading-time {
            background: #f3f4f6;
            color: #6b7280;
            padding: 2px 8px;
            border-radius: 8px;
            font-size: 11px;
            font-weight: 500;
        }
    </style>
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/atom-one-dark.min.css">

    {#  CSS (kod style + copy button)#}
    <style>
        pre {
            position: relative;
            margin: 1.5rem 0;
            background: #1e1e1e;
            border-radius: 0.75rem;
            overflow: auto;
        }

        pre code {
            font-family: 'Cascadia Code', 'Fira Code', 'Consolas', monospace;
            font-size: 0.9rem;
            padding: 1rem;
            display: block;
        }

        /* Copy button style */
        .copy-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            background: #4f46e5; /* indigo */
            color: white;
            border: none;
            padding: 4px 10px;
            font-size: 0.75rem;
            border-radius: 0.375rem;
            cursor: pointer;
            opacity: 0.8;
            transition: opacity 0.2s;
        }

        .copy-btn:hover {
            opacity: 1;
        }
    </style>
{% endblock %}

{% block content %}

    <!-- Blog Detail Full Page -->
    <div class="min-h-screen bg-gray-50 py-10 px-4 flex justify-center">
        <div class="bg-white rounded-xl shadow-2xl max-w-4xl w-full relative overflow-hidden border border-gray-200">

            <!-- Header -->
            <div class="relative">
                <div id="blog-detail-cover"
                     class="h-64 bg-gradient-to-br from-blue-400 to-blue-600 relative overflow-hidden">
                    <div class="absolute inset-0 bg-black bg-opacity-20"></div>
                    <div class="absolute bottom-6 left-6 right-6">
                        <h1 id="blog-detail-title" class="text-3xl font-bold text-white mb-2">{{ blog.title }}</h1>
                        <div class="flex items-center space-x-4 text-white/90">
                            <div class="flex items-center space-x-2">
                                <div id="blog-detail-avatar" class="author-avatar">MK</div>
                                <div>
                                    <div id="blog-detail-author" class="font-medium">Mike Chen</div>
                                    <div class="text-sm opacity-75">
                                        Published <span id="blog-detail-date">{{ blog.created_at|date:"M d, Y" }}</span>
                                    </div>
                                </div>
                            </div>
                            <div class="flex items-center space-x-3 text-sm">
                                <span id="blog-detail-reading-time"
                                      class="bg-white/20 px-2 py-1 rounded">8 min read</span>
                                <span id="blog-detail-steps-count"
                                      class="bg-yellow-500 text-white px-2 py-1 rounded font-semibold">
                                {{ blog.steps.count }} steps
                            </span>
                            </div>
                        </div>
                    </div>
                    <div id="blog-detail-icon"
                         class="absolute inset-0 flex items-center justify-center text-6xl opacity-20">üöÄ
                    </div>
                </div>
            </div>

            <!-- Content -->
            <div class="p-8">
                <!-- Blog Description -->
                <div class="prose max-w-none mb-8">
                    <div id="blog-detail-description" class="text-gray-700 leading-relaxed text-lg">
                        {{ blog.description|safe }}
                    </div>
                </div>

                <!-- Steps Section -->
                <div class="border-t border-gray-200 pt-8">
                    <h2 class="text-2xl font-bold text-gray-900 mb-6">Tutorial Steps</h2>

                    {% for step in steps %}
                        <div class="bg-gray-50 rounded-xl p-6 mb-6">
                            <h3 class="text-xl font-semibold text-gray-900 mb-3">{{ step.title }}</h3>
                            <div class="text-gray-700 leading-relaxed prose">
                                {{ step.description|safe }}
                            </div>
                        </div>
                    {% endfor %}
                </div>

                <!-- Blog Actions -->
                <div class="border-t border-gray-200 pt-6 mt-8">
                    <div class="flex items-center justify-between flex-wrap gap-4">
                        <div class="flex items-center space-x-3">
                            <button onclick="printBlog()"
                                    class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
                                üñ®Ô∏è Print Guide
                            </button>
                            <button onclick="downloadPDF()"
                                    class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                                üìÑ Download PDF
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

{% endblock %}

{% block custom_js %}
    <script>
        function printBlog() {
            window.print();
        }

        function downloadPDF() {
            alert("üìÑ Downloading blog as PDF...");
        }
    </script>
    {#  JavaScript (highlight + copy function)  #}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            // Highlight.js init
            document.querySelectorAll("pre code").forEach(el => {
                hljs.highlightElement(el);

                // Add copy button
                const button = document.createElement("button");
                button.innerText = "Copy";
                button.className = "copy-btn";
                el.parentNode.appendChild(button);

                button.addEventListener("click", () => {
                    navigator.clipboard.writeText(el.innerText).then(() => {
                        button.innerText = "Copied!";
                        setTimeout(() => (button.innerText = "Copy"), 2000);
                    });
                });
            });
        });
    </script>
{% endblock %}
